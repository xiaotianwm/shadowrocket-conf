[General]
bypass-system = true
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, captive.apple.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32
dns-server = system
ipv6 = true

[Rule]
# =========================================================
# 👻 幽灵直播 V23 - 纯净版 (源站猎杀)
# =========================================================

# --- 1. 【优先级最高】绝对阻断视频源 (必须在放行之前!) ---
# 拦截包含 "source" 的域名 (杀掉 lf16-gecko-source, sf-teko-source 等)
DOMAIN-KEYWORD, source, REJECT
# 拦截 lf (Live Feed) 开头的视频推流域名
DOMAIN-KEYWORD, lf16, REJECT
DOMAIN-KEYWORD, lf19, REJECT
DOMAIN-KEYWORD, lf77, REJECT
# 拦截其他已知视频关键词
DOMAIN-KEYWORD, video, REJECT
DOMAIN-KEYWORD, v3-dy, REJECT
DOMAIN-KEYWORD, v9-dy, REJECT

# --- 2. 【内鬼拦截】(之前的补丁) ---
DOMAIN-KEYWORD, hotapi, REJECT
DOMAIN-KEYWORD, cp-rp, REJECT
DOMAIN-SUFFIX, live-netacc.tiktokv.com, REJECT

# --- 3. 【组件放行】恢复 App 功能 ---
# Gecko 必须放行，但带 source 的 gecko 已经在第1步被杀了，这里放行的是安全的
DOMAIN-KEYWORD, gecko, PROXY
DOMAIN-KEYWORD, tnc, PROXY
DOMAIN-KEYWORD, vcs, PROXY
DOMAIN-KEYWORD, search, PROXY
DOMAIN-KEYWORD, oec, PROXY
DOMAIN-KEYWORD, jsb, PROXY
DOMAIN-KEYWORD, mssdk, PROXY
DOMAIN-SUFFIX, ibytedtos.com, PROXY

# --- 4. 【信令放行】 ---
DOMAIN-KEYWORD, webcast, PROXY
DOMAIN-SUFFIX, frontier.tiktokv.com, PROXY

# --- 5. 【API 放行】 ---
DOMAIN-KEYWORD, api-h2, PROXY
DOMAIN-KEYWORD, api16, PROXY
DOMAIN-KEYWORD, api19, PROXY
DOMAIN-KEYWORD, api22, PROXY

# --- 6. 【图片放行】 ---
# 只放行 p 开头的图片
DOMAIN-REGEX, ^p[0-9].*$, PROXY
DOMAIN-SUFFIX, ibyteimg.com, PROXY
DOMAIN-SUFFIX, appsflyersdk.com, PROXY

# =========================================================
# ⛔ 【兜底阻断】
# =========================================================

# 1. 视频 CDN
DOMAIN-SUFFIX, tiktokcdn.com, REJECT
DOMAIN-SUFFIX, tiktokv.com, REJECT

# 2. 端口与协议
AND, ((DEST-PORT,80)), REJECT
AND, ((PROTOCOL,UDP)), REJECT

# 3. 直连 IP (Log 历史积累)
IP-CIDR, 38.60.0.0/16, REJECT
IP-CIDR, 128.1.0.0/16, REJECT
IP-CIDR, 71.18.0.0/16, REJECT
IP-CIDR, 156.238.0.0/16, REJECT
IP-CIDR, 122.10.0.0/16, REJECT
IP-CIDR, 45.197.0.0/16, REJECT
IP-CIDR, 162.128.0.0/16, REJECT
IP-CIDR, 149.104.0.0/16, REJECT
IP-CIDR, 122.155.0.0/16, REJECT
IP-CIDR, 198.18.0.0/15, REJECT

# =========================================================
# 🛡️ 常规规则
# =========================================================
DOMAIN-SUFFIX, local, DIRECT
IP-CIDR, 192.168.0.0/16, DIRECT
IP-CIDR, 10.0.0.0/8, DIRECT
IP-CIDR, 172.16.0.0/12, DIRECT
IP-CIDR, 127.0.0.0/8, DIRECT

# =========================================================
# ⛔ 终极兜底
# =========================================================
FINAL, REJECT
