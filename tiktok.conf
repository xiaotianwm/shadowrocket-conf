[General]
bypass-system = true
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, captive.apple.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32
dns-server = system
ipv6 = true

[Proxy]
GhostStreamNode = trojan, sg.6756153.xyz, 12615, password=93zD1hDgNn, allow-insecure=true, alpn=h2,http/1.1, fingerprint=chrome

[Proxy Group]
MatchAll = select, GhostStreamNode

[Rule]
# =========================================================
# 👻 幽灵直播 V21 - 基础服务复活版
# =========================================================

# --- 1. 【内鬼拦截】优先杀掉已知的偷跑通道 ---
# hotapi: 必须死，它是最常见的备用推流通道
DOMAIN-KEYWORD, hotapi, REJECT
# cp-rp16: 伪装成图片的上传通道
DOMAIN-KEYWORD, cp-rp, REJECT
# live-netacc: 推流加速网关
DOMAIN-SUFFIX, live-netacc.tiktokv.com, REJECT

# --- 2. 【核心放行】恢复开播与组件 (WhiteList) ---
# [信令] 恢复 HTTP 握手，解决“无网络”
DOMAIN-KEYWORD, webcast, MatchAll
DOMAIN-SUFFIX, frontier.tiktokv.com, MatchAll
DOMAIN-SUFFIX, ibytedtos.com, MatchAll

# [基础服务] 解决“组件无法加载” (Log9 中被误杀的域名)
DOMAIN-KEYWORD, bsync, MatchAll
DOMAIN-KEYWORD, tnc, MatchAll
DOMAIN-KEYWORD, libra, MatchAll
DOMAIN-KEYWORD, vcs, MatchAll
DOMAIN-KEYWORD, search, MatchAll
DOMAIN-KEYWORD, gecko, MatchAll
DOMAIN-KEYWORD, mon, MatchAll
DOMAIN-KEYWORD, mssdk, MatchAll

# [API] 核心接口
DOMAIN-KEYWORD, api-h2, MatchAll
DOMAIN-KEYWORD, api16, MatchAll
DOMAIN-KEYWORD, api19, MatchAll
DOMAIN-KEYWORD, api22, MatchAll

# [第三方] 广告与统计 (不放行可能卡启动)
DOMAIN-SUFFIX, appsflyersdk.com, MatchAll

# --- 3. 【图片资源】 ---
# 只允许 p 开头的图片，防止 cp-rp16 混入
DOMAIN-REGEX, ^p[0-9].*$, MatchAll
DOMAIN-SUFFIX, ibyteimg.com, MatchAll

# =========================================================
# ⛔ 【兜底猎杀】 (BlackList)
# =========================================================

# 1. 视频 CDN (v3, v16, v53 等)
# 正则匹配 v+数字 开头的域名，杀掉所有视频流
DOMAIN-REGEX, ^v[0-9].*\.tiktokcdn\.com$, REJECT

# 2. 视频源站 (sf-teko, lf16-gecko-source 等)
DOMAIN-KEYWORD, -source, REJECT
DOMAIN-KEYWORD, -effectcdn, REJECT
DOMAIN-KEYWORD, sf-, REJECT

# 3. 封死 80 端口 (HTTP 推流)
AND, ((DEST-PORT,80)), REJECT

# 4. 封死所有 UDP (RTC 推流)
AND, ((PROTOCOL,UDP)), REJECT

# 5. 封死直连 IP (Log 中抓到的 ByteDance IP 段)
IP-CIDR, 38.60.0.0/16, REJECT
IP-CIDR, 128.1.0.0/16, REJECT
IP-CIDR, 71.18.0.0/16, REJECT
IP-CIDR, 156.238.0.0/16, REJECT
IP-CIDR, 122.10.0.0/16, REJECT
IP-CIDR, 45.197.0.0/16, REJECT
IP-CIDR, 162.128.0.0/16, REJECT
IP-CIDR, 149.104.0.0/16, REJECT
IP-CIDR, 122.155.0.0/16, REJECT
IP-CIDR, 198.18.0.0/15, REJECT

# =========================================================
# 🛡️ 常规规则
# =========================================================
DOMAIN-SUFFIX, local, DIRECT
IP-CIDR, 192.168.0.0/16, DIRECT
IP-CIDR, 10.0.0.0/8, DIRECT
IP-CIDR, 172.16.0.0/12, DIRECT
IP-CIDR, 127.0.0.0/8, DIRECT

# =========================================================
# ⛔ 终极兜底 (零信任)
# =========================================================
FINAL, REJECT
