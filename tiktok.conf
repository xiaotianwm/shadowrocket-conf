[General]
bypass-system = true
skip-proxy = 192.168.0.0/16, 10.0.0.0/8, 172.16.0.0/12, localhost, *.local, captive.apple.com
tun-excluded-routes = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32
dns-server = system
ipv6 = true

[Proxy]
GhostStreamNode = trojan, sg.6756153.xyz, 12615, password=93zD1hDgNn, allow-insecure=true, alpn=h2,http/1.1, fingerprint=chrome

[Proxy Group]
MatchAll = select, GhostStreamNode

[Rule]
# =========================================================
# 👻 幽灵直播 V23 - 源站猎杀版
# =========================================================

# --- 1. 【优先级最高】绝对阻断视频源 (必须放在放行规则之前!) ---
# 杀掉 Log 中的漏网之鱼 lf16-gecko-source
DOMAIN-KEYWORD, source, REJECT
# 杀掉 lf (Live Feed) 开头的域名
DOMAIN-KEYWORD, lf16, REJECT
DOMAIN-KEYWORD, lf19, REJECT
DOMAIN-KEYWORD, lf77, REJECT
# 杀掉视频相关的其他关键词
DOMAIN-KEYWORD, video, REJECT
DOMAIN-KEYWORD, v3-dy, REJECT
DOMAIN-KEYWORD, v9-dy, REJECT

# --- 2. 【内鬼拦截】(之前的补丁) ---
DOMAIN-KEYWORD, hotapi, REJECT
DOMAIN-KEYWORD, cp-rp, REJECT
DOMAIN-SUFFIX, live-netacc.tiktokv.com, REJECT

# --- 3. 【组件放行】恢复 App 功能 ---
# 现在可以安全放行 gecko 了，因为带 source 的已经被上面拦截了
DOMAIN-KEYWORD, gecko, MatchAll
DOMAIN-KEYWORD, tnc, MatchAll
DOMAIN-KEYWORD, vcs, MatchAll
DOMAIN-KEYWORD, search, MatchAll
DOMAIN-KEYWORD, oec, MatchAll
DOMAIN-KEYWORD, jsb, MatchAll
DOMAIN-KEYWORD, mssdk, MatchAll
DOMAIN-SUFFIX, ibytedtos.com, MatchAll

# --- 4. 【信令放行】 ---
DOMAIN-KEYWORD, webcast, MatchAll
DOMAIN-SUFFIX, frontier.tiktokv.com, MatchAll

# --- 5. 【API 放行】 ---
DOMAIN-KEYWORD, api-h2, MatchAll
DOMAIN-KEYWORD, api16, MatchAll
DOMAIN-KEYWORD, api19, MatchAll
DOMAIN-KEYWORD, api22, MatchAll

# --- 6. 【图片放行】 ---
DOMAIN-REGEX, ^p[0-9].*$, MatchAll
DOMAIN-SUFFIX, ibyteimg.com, MatchAll
DOMAIN-SUFFIX, appsflyersdk.com, MatchAll

# =========================================================
# ⛔ 【兜底阻断】
# =========================================================

# 1. 视频 CDN
DOMAIN-SUFFIX, tiktokcdn.com, REJECT
DOMAIN-SUFFIX, tiktokv.com, REJECT

# 2. 端口与协议
AND, ((DEST-PORT,80)), REJECT
AND, ((PROTOCOL,UDP)), REJECT

# 3. 直连 IP
IP-CIDR, 38.60.0.0/16, REJECT
IP-CIDR, 128.1.0.0/16, REJECT
IP-CIDR, 71.18.0.0/16, REJECT
IP-CIDR, 156.238.0.0/16, REJECT
IP-CIDR, 122.10.0.0/16, REJECT
IP-CIDR, 45.197.0.0/16, REJECT
IP-CIDR, 162.128.0.0/16, REJECT
IP-CIDR, 149.104.0.0/16, REJECT
IP-CIDR, 122.155.0.0/16, REJECT
IP-CIDR, 198.18.0.0/15, REJECT

# =========================================================
# 🛡️ 常规规则
# =========================================================
DOMAIN-SUFFIX, local, DIRECT
IP-CIDR, 192.168.0.0/16, DIRECT
IP-CIDR, 10.0.0.0/8, DIRECT
IP-CIDR, 172.16.0.0/12, DIRECT
IP-CIDR, 127.0.0.0/8, DIRECT

# =========================================================
# ⛔ 终极兜底
# =========================================================
FINAL, REJECT
